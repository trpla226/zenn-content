---
title: "Delegateã¨DataSourceã‚’ä½¿ã£ãŸTableViewã«ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒã‚’å®Ÿè£…ã™ã‚‹"
emoji: "ğŸ”"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Mac", "Xamarin", "Cocoa", "CSharp", "XCode"]
published: true 
---

ã‚„ã‚ŠãŸã„ã“ã¨
====

Xamarin.Macã‚’ä½¿ã£ãŸãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã§ã€TableViewã«çµã‚Šè¾¼ã¿æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ãŸã„ã€‚

è¡¨ã®ç”¨æ„
====

é©å½“ãªè¡¨ã®ä¾‹ã¨ã—ã¦ã€ä»¥ä¸‹ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’å‚è€ƒã«VNOSã®ãƒ¡ãƒ³ãƒãƒ¼ï¼ˆã®ä¸€éƒ¨ï¼‰ã¨ãã®Twitterã®IDã‚’ä¸€è¦§è¡¨ç¤ºã™ã‚‹è¡¨ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚

[ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã—ã¦ã¿ã¾ã—ãŸ](https://dev.classmethod.jp/articles/xamarin-mac-table-view/)

![](https://storage.googleapis.com/zenn-user-upload/i9nlqkfxcrlaa8vn8zruwvdlikn7)

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚
```csharp
using System;
using System.Collections.Generic;
using AppKit;
using Foundation;
namespace tablesearch
{
    public partial class ViewController : NSViewController
    {
        readonly MemberTableViewDataSource dataSource = new MemberTableViewDataSource();
        IReadOnlyCollection<Member> Members;
        public ViewController(IntPtr handle) : base(handle)
        {
            Members = new List<Member>
            {
                new Member("a2see","a2see"),
                new Member("ã†ã‡ã‚‹ã¡","welchi_"),
                new Member("æƒ³é–“ãƒŸãƒ¬ã‚¤","zerovabi"),
                new Member("æœˆè¦‹ã­ãã¨ã‚","tukimi_negitoro"),
                new Member("å‰µå¥½ãƒªãƒŠ","TsukusuLina"),
                new Member("ã§ã‚“ã˜ãƒ","den_oldman"),
                new Member("ã¨ã‚Šãˆ","trpla226"),
                new Member("ãªã‚‚ãªã","nam0naki"),
            }.AsReadOnly();
            dataSource.Members = new List<Member>(Members);
        }
        public override void ViewDidLoad()
        {
            base.ViewDidLoad();
            MemberTableView.DataSource = dataSource;
            MemberTableView.Delegate = new MemberTableViewDelegate(dataSource);
        }
        public override NSObject RepresentedObject
        {
            get
            {
                return base.RepresentedObject;
            }
            set
            {
                base.RepresentedObject = value;
                // Update the view, if already loaded.
            }
        }
    }
    public class MemberTableViewDataSource : NSTableViewDataSource
    {
        public List<Member> Members { get; set; } = new List<Member>();
        public override nint GetRowCount(NSTableView tableView)
        {
            return Members.Count;
        }
    }
    public class MemberTableViewDelegate : NSTableViewDelegate
    {
        private const string CellIdentifier = "MemberCell";
        private MemberTableViewDataSource dataSource;
        public MemberTableViewDelegate(MemberTableViewDataSource dataSource)
        {
            this.dataSource = dataSource;
        }
        public override NSView GetViewForItem(NSTableView tableView,
            NSTableColumn tableColumn,
            nint row)
        {
            NSTextField view = (NSTextField)tableView.MakeView(CellIdentifier, this);
            if (view == null)
            {
                view = new NSTextField();
                view.Identifier = CellIdentifier;
                view.BackgroundColor = NSColor.Clear;
                view.Bordered = false;
                view.Editable = false;
                view.Selectable = false;
            }
            var member = dataSource.Members[(int)row];
            switch(tableColumn.Title)
            {
                case "Name":
                    view.StringValue = member.Name;
                    break;
                case "Twitter ID":
                    view.StringValue = member.TwitterId;
                    break;
            }
            return view;
        }
    }
}
```

åå‰ã¨Twitter IDã®ãµãŸã¤ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒã¤å˜ç´”ãªãƒ¢ãƒ‡ãƒ«ã§ã‚ã‚‹Memberã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã—ã€TableViewDataSourceå†…ã«ãƒªã‚¹ãƒˆã§ä¿æŒã—ã€è¡¨ç¤ºæ™‚ã«ã¯NSTableViewDelegateãŒViewã‚’ç”Ÿæˆã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

ã¾ãŸã€ViewControllerã‹ã‚‰TableViewã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã€ã‚ã‚‰ã‹ã˜ã‚XCode Interface Builderã«ã¦TableViewã®Referencing Outletã‚’ä½œã£ã¦ã‚ã‚Šã¾ã™ã€‚

çµã‚Šè¾¼ã¿æ©Ÿèƒ½ã®å®Ÿè£…
====

Search Fieldã®Actionã‚’ä½œæˆ
----

Search Fieldã«å…¥åŠ›ã•ã‚Œã‚‹ãŸã³ã«çµã‚Šè¾¼ã¿å‡¦ç†ãŒå‘¼ã°ã‚Œã‚‹ã‚ˆã†ã€Actionã‚’ViewControllerã«è¿½åŠ ã—ã¾ã™ã€‚

ViewController.hã‚’åˆ¥ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§é–‹ãã€Controlã‚­ãƒ¼ã‚’æŠ¼ä¸‹ã—ãªãŒã‚‰Interface Builderä¸Šã®Search Fieldã‹ã‚‰ViewController.hã®ã‚¨ãƒ‡ã‚£ã‚¿ä¸Šã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/e7hggiktw2jw9dxgfit6dtj4cva4)
Outletã‹ã‚‰Actionã«å¤‰æ›´ã—ã€KeywordChangedã¨åã¥ã‘ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/jwllm6r9z1xj42cji2t0jtkd05uq)


KeywordChangedã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å®Ÿè£…
----

Visual Studioã«æˆ»ã‚Šã€å…ˆã»ã©ã®ViewController.csã«å‡¦ç†ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

Actionã‚’è¿½åŠ ã—ãŸã“ã¨ã§ã€View Controllerã«ã¯ã™ã§ã«KeywordChangedãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚·ã‚°ãƒãƒãƒ£ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚ViewControllerã«partialãªãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```csharp
partial void KeywordChanged(NSObject sender)
{
    var keyword = ((NSSearchField)sender).StringValue;
    dataSource.Members = Members
        .Where(member => member.Name.Contains(keyword))
        .ToList();
    MemberTableView.ReloadData();
}
```

ãƒã‚¹ã‚¿ã«ãªã‚‹Listã®ä¸­ã‹ã‚‰æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ã‚‚ã®ã‚’Whereãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¦ã€dataSourceå†…ã®Listã«å†ä»£å…¥ã—ã¦ã„ã¾ã™ã€‚

å®Ÿè¡Œçµæœ
====

ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ã€ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã§ç¢ºå®šã™ã‚‹ã¨æ¡ä»¶ã«åˆã†ã‚‚ã®ã ã‘ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã¾ãŸã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å³ç«¯ã®Ã—å°ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨çµã‚Šè¾¼ã¿ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/53eh4odr4an9qo8wmr3qjwoj857j)

ãŠã‚ã‚Šã«
====

ä»Šå›ã€å˜ç´”ãªéƒ¨åˆ†ä¸€è‡´ã§å®Ÿè£…ã—ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã«ã¯å¤§æ–‡å­—å°æ–‡å­—ã®é•ã„ã‚’ç„¡è¦–ã—ãŸã‚Šã€åŠè§’å…¨è§’ã®é•ã„ã‚’ç„¡è¦–ã—ã¦æ¤œç´¢ã—ãŸæ–¹ãŒä½¿ã„ã‚„ã™ã„å ´åˆãŒå¤šã„ã¨æ€ã„ã¾ã™ã®ã§ã€å·¥å¤«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ãƒ©ãƒ™ãƒ«ã¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ©ã‚¤ãƒ³ãŒç¶ºéº—ã«æƒã£ã¦ã„ãªãã¦ç¾ã—ããªã„ã§ã™ã­ã€‚ä¸Šæ‰‹ãæƒãˆã‚‹æ–¹æ³•ã‚’çŸ¥ã£ã¦ã„ãŸã‚‰æ•™ãˆã¦ãã ã•ã„ã€‚

ç’°å¢ƒ
====

Mac OS X 10.15.6
Visual Studio for Mac Community 8.8.1(build 37)
Xamarin Mac 7.0.0.15
XCode Version 12.2
